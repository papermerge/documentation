{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Papermerge DMS","text":"<p>Papermerge DMS or simply Papermerge is a open source document management system designed to work with scanned documents (also called digital archives). It extracts text from your scans using OCR, indexes them, and prepares them for full text search. Papermerge provides look and feel of modern desktop file browsers. It has features like dual panel document browser, drag and drop, tags, hierarchical folders and full text search so that you can efficiently store and organize your documents.</p> <p>It supports PDF, TIFF, JPEG and PNG document file formats. Papermerge is perfect tool for long term storage of your documents.</p> <p></p>"},{"location":"#features-highlights","title":"Features Highlights","text":"<ul> <li>Works with PDF, TIFF, JPEG, PNG formats</li> <li>Desktop like user interface</li> <li>Dual panel mode</li> <li>OCR - used to extract text for documents indexing</li> <li>OCRed text overlay (you can download document with OCRed text overlay)</li> <li>Full text search (supports multiple search engines)</li> <li>Document Versioning</li> <li>Tags - assign colored tags to documents or folders</li> <li>Folders - users can organize documents in folders</li> <li>Multi-User</li> <li>Fully REST API</li> <li>Page Management - delete, reorder, rotate, merge, move, extract</li> </ul>"},{"location":"#what-it-does","title":"What It Does","text":"<ul> <li>It extracts (using OCR) and indexes text from your documents</li> <li>Provides modern, desktop like user interface to easily find your documents</li> <li>Helps you instantly find your documents</li> <li>Helps you fix scanned documents issues like:</li> <li>delete blank, semi-blank or just irrelevant pages</li> <li>rotate pages</li> <li>move strayed pages between documents</li> <li>change page order within the document</li> </ul>"},{"location":"#what-it-doesnt-do","title":"What It Doesn't Do","text":"<ul> <li>It does not take control of your documents. Documents are stored on   filesystem in a simple and intuitive manner so that you can take snapshot of   your data at any time</li> <li>It does not overwrite your original documents</li> </ul>"},{"location":"#what-is-a-document","title":"What is a Document?","text":"<p>For Papermerge a document is anything which is a good candidate for archiving - some piece of information which is not editable but you need to store it for future reference. For example receipts are good examples - you don't need to read receipts everyday, but eventually you will need them for your tax declaration. In this sense - scanned documents, which are usually in PDF or TIFF format, are perfect match.</p> <p>PDF (Portable Document Format) is de facto standard for storing archived documents. In correct technical terms - it is PDF/A subset. PDF/A differs from PDF by prohibiting features unsuitable for long-term archiving, such as font linking and encryption.</p> <p>Most of the modern office scanners will output scanned files in PDF/A format. This is why, PDF is practically synonymous for document in context of Papermerge.</p> <p>A picture made with smart phone of A4 paper document is regarded by Papermerge as document.</p>"},{"location":"backup-restore/","title":"Backup/Restore","text":"<p>Papermerge docker image is shipped with backup and restore utilities. Shipped utility will backup all your folders, documents with their associated versions and OCR data, tags and users. Search engine index is not included in backup though.</p> <p>Note</p> <p>User passwords are included in backup file as well. Passwords are stored as digests.</p>"},{"location":"backup-restore/#backup","title":"Backup","text":"<p>Backup your documents with following command:</p> <pre><code>$ docker exec &lt;papermerge-server-container&gt; backup.sh &lt;optional-location&gt;\n</code></pre> <p>where <code>&lt;optional-location&gt;</code> is the path to file or folder inside container where to save backup file. If location is not provided, backup file will be saved in /core_app/ folder - the papermerge core application's current folder.</p> <p>Example:</p> <pre><code>    $ docker ps --format '{\\{.ID\\}} {\\{.Command\\}} {\\{.Names\\}}'\n\n    914dda21dd3d \"/run.bash server\" 091223_30-web-1\n    42095cee91f0 \"docker-entrypoint.s\u2026\" 091223_30-solr-1\n    d65b3205d9ec \"/run.bash worker\" 091223_30-worker-1\n    ac5cfd76993a \"docker-entrypoint.s\u2026\" 091223_30-redis-1\n    8ad6d0a7eb6c \"/opt/bitnami/script\u2026\" 091223_30-db-1\n</code></pre> <p>In above example the Papermerge has 5 containers: app server (the core or web or http or REST API server, pick the name you like :P), solr search engine, redis, database and finally one paper worker.</p> <p>To create a backup in root folder of the app container just run:</p> <pre><code>$ docker exec 914dda21dd3d backup.sh /\n</code></pre> <p>When above command is ready, check that backup file was created:</p> <pre><code>$ docker exec 914dda21dd3d ls /\n\nauth_server_app\nbackup_10_12_2023-11_30_37.tar.gz\nbin\nboot\n...\ncore_app\ncore_ui\ndb\n...\nusr\nvar\n</code></pre> <p>Backup file is backup_10_12_2023-06_30_37.tar.gz. Now you can copy backup file to your local filesystem:</p> <pre><code>$ docker cp 914dda21dd3d:/backup_10_12_2023-06_30_37.tar.gz .\n</code></pre> <p>You may choose to name file differently:</p> <pre><code>$ docker exec 914dda21dd3d backup.sh /my-daily-backup.tar.gz\n</code></pre> <p>Then copy it to your local filesystem:</p> <pre><code>$ docker cp 914dda21dd3d:/my-daily-backup.tar.gz .\n</code></pre> <p>Note</p> <p>Backup files are gzipped tar archives, thus you probably want to append \".tar.gz\" to their name.</p>"},{"location":"backup-restore/#restore","title":"Restore","text":"<p>When you plan to restore previous backup, we suggest to start with new Papermerge instance, with only one superuser (which is created by default anyway). Make sure there are no documents in the new instance.</p> <p>For sake of example, let's say the superuser's username is \"admin\". For restoring use <code>restore.sh</code> command:</p> <pre><code>$ docker exec &lt;papermerge-server-container&gt; restore.sh &lt;backup-file&gt;\n</code></pre> <p>For that to work, you need first to copy backup archive file to core (server) container. Sticking with example from previous section:</p> <pre><code>$ docker cp my-backup.tar.gz 914dda21dd3d:/my-backup.tar.gz\n$ docker exec 914dda21dd3d restore.sh /my-backup.tar.gz\n</code></pre> <p>If \"admin\" user already existed in backup file, then admin's password will be set to the one from the backup file.</p>"},{"location":"backup-restore/#backup-file-structure","title":"Backup File Structure","text":"<p>The backup file is a gzipped tar archive with following content:</p> <ol> <li><code>backup.json</code> file</li> <li><code>ocr/</code> folder</li> <li><code>docvers/</code>  folder</li> <li><code>username1</code>/, <code>username2</code>, ... i.e. one folder per user with folder title being user's username</li> </ol> <p><code>backup.json</code> file contains all necessary info to restore the database i.e. all users, their nodes, tags etc.</p> <p><code>docvers/</code> contains actually document versions files. Your documents are here.</p> <p><code>ocr/</code> contains OCR data of each individual page in the document.</p> <p>User folders mentioned in point 4. are provided for convenience, so that you may quickly get an understanding of the folder structure and their content. Each file in user folder is actually a symbolic link pointing to the last version of the document (from <code>docvers</code>).</p> <p>Warning</p> <p>Each user has two special folders: <code>.home</code> and <code>.inbox</code>; special folder's title start with dot. If you open backup archive in file browsers which hides dot files (file starting with dot character) - the content of user folder may appear empty! When opening backup archive make sure you set 'show hidden files flag' on.</p>"},{"location":"changelog/","title":"Changelog","text":"<p>For complete changelog see changelog file in github repository.</p>"},{"location":"cli/cli/","title":"Papermerge CLI","text":"<p>Command line utility which uses REST API to interact with your Papermerge instance. It can be used to upload documents from local filesystem to yout Papermerge instance.</p> <p></p>"},{"location":"cli/cli/#requirements","title":"Requirements","text":"<p>In order to use <code>papermerge-cli</code> you need to have python installed. You need python version &gt;= 3.10.</p>"},{"location":"cli/cli/#install","title":"Install","text":"<p>Install <code>papermerge-cli</code> with following command:</p> <pre><code>pip install papermerge-cli\n</code></pre> <p>pip is package installer for python - it usually comes with python interpreter. In order to install pip on Ubuntu use following command:</p> <pre><code>sudo apt install python3-pip\n</code></pre>"},{"location":"cli/cli/#configuration","title":"Configuration","text":"<p>Papermerge Cli is configured via environment variables:</p> <ul> <li><code>PAPERMERGE_CLI__HOST</code></li> <li><code>PAPERMERGE_CLI__TOKEN</code></li> </ul> <p>as the name suggests, the first one is the host of the REST API server and second value is the REST API token.</p> <p>REST API server should be specified with <code>http://</code> or <code>https://</code> prefix, but without the <code>/api</code> suffix. Valid values examples: http://papermege.local, https://my-dms.papermerge.de.</p> <p>Note</p> <p>The host may or may not contain the <code>/</code>. E.g. http://papermege.local and http://papermerge.local/ are both valid values and point to the same host</p> <p>REST API token can be obtained from Papermerge <code>user menu -&gt; API Tokens &lt;rest_api_token&gt;</code>.</p>"},{"location":"cli/cli/#ls","title":"ls","text":"<p>List the content of you home folder:</p> <pre><code>  papermerge-cli ls\n</code></pre> <p>In order to list content of specific folder (including inbox folder)::</p> <pre><code>  papermerge-cli ls --parent-uuid=UUID-of-the-folder\n</code></pre>"},{"location":"cli/cli/#me","title":"me","text":"<p>In order to see current user details use <code>me</code> command:</p> <pre><code>  papermerge-cli me\n</code></pre>"},{"location":"cli/cli/#import","title":"import","text":"<p>Recursively imports documents and folders from local filesystem. For example, in order to import recursively all documents from local folder:</p> <pre><code>papermerge-cli import /path/to/local/folder/\n</code></pre> <p>You can also import one single document:</p> <pre><code>papermerge-cli import /path/to/some/document.pdf\n</code></pre> <p>By default all documents are imported to your user's <code>.inbox</code> folder. If you want to import to another folder, use <code>--target-uuid</code>:</p> <pre><code>papermerge-cli import /path/to/some/document.pdf --target-uuid &lt;uuid&gt;\n</code></pre> <p>In order to learn UUID of the folder you want to import to use <code>papermerge-cli ls</code> command. To get UUIDs of <code>.home</code> and <code>.inbox</code> folders, use <code>papermerge-cli me</code> command.</p> <p>If you want the local copy the uploaded documents to be deleted after successful import - use <code>--delete</code> flag:</p> <pre><code>papermerge-cli import --delete /path/to/folder/\n</code></pre> <p>Danger</p> <p>Be careful with <code>--delete</code> flag! When present,</p> <p><code>papermerge-cli</code> will irreversible delete the local copy of all    documents and folders in the <code>/path/to/folder/</code>!</p> <p>Danger</p> <p>Always, before using this flag make safe backup of the documents to be uploaded!</p> <p>!!! note: <code>--delete</code> flag deletes the local copy of the documents/path to import     after successful upload - this means that even if though you local copy     of the documents vanished - the originals are still available in Papermerge!</p>"},{"location":"cli/cli/#help","title":"help","text":"<p>In order to get general help about the command use:</p> <pre><code>  papermerge-cli --help\n</code></pre> <p>In order to get help for individual commands, place <code>--help</code> flag after the command:</p> <pre><code>  papermerge-cli import --help\n</code></pre>"},{"location":"cli/overview/","title":"Overview","text":"<p>This section describes a set of command line utilities which can interact (e.g. import documents to, list nodes etc) with your Papermerge instance.</p> <p>What is common to all command line utilities listed here is that they all use REST API interface. In order to use REST API you need to know:</p> <ul> <li>host address of the REST API server</li> <li>the token used for authentication - REST API token</li> </ul>"},{"location":"cli/overview/#host-address","title":"Host Address","text":"<p>Host address should be provided with <code>http://</code> or <code>https://</code> prefix.</p> <p>Examples:</p> <ul> <li>http://papermerge.local</li> <li>https://mydms.com/</li> <li>https://my-own-digital-archives.de</li> </ul> <p>Note</p> <p>REST API server may or may not end with <code>/</code> character. Thus, both http://papermerge.local     and http://papermerge.local/ are valid.</p>"},{"location":"cli/overview/#rest-api-token","title":"REST API Token","text":"<p>You get REST API token from web UI of your Papermerge instance. In user menu (upper right corner) go to REST API Token menu item.</p> <p>Further details are described in user manual.</p>"},{"location":"contributor/docker/","title":"Docker","text":"<p>There is docker image for development mode. Docker image is tagged with <code>3.0devX</code>. With dev image, you can get feedback of your source code changes without needing to install any dependency or any deveopment environment configurations.</p> <p>All examples described below assume that you got Papermerge source code and you are in root repository of source code folder:</p> <pre><code>$ git clone git@github.com:papermerge/papermerge-core.git PapermergeSourceCode\n$ cd PapermergeSourceCode\n</code></pre>"},{"location":"contributor/docker/#web-app","title":"Web App","text":"<p>This is the simplest local dev scenario, you start docker compose file only with web app i.e. REST API server + ui.</p> <p>The go to the folder where source was cloned and create following docker compose file:</p> <pre><code>version: \"3.9\"\n\nservices:\n  backend:\n    image: papermerge/papermege:3.0dev  # check the latest dev image number in dockerhub!\n    volumes:\n        - ./papermerge:/core_app/papermerge/\n        - ./ui:/core_ui/\n    environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234  # top secret\n      PAPERMERGE__AUTH__USERNAME: admin\n      PAPERMERGE__AUTH__PASSWORD: 1234\n    ports:\n      - \"11000:80\"\n</code></pre> <p>Assuming you are in root folder of the source code, above docker compose will mount the source code to the correct location in docker image. The appliction will be accessible to on local port 11000.</p> <p>Here is docker compose file for the case when you want to build dev docker image yourself:</p> <pre><code>version: \"3.9\"\n\nservices:\n  backend:\n    build:\n      context: .\n      dockerfile: docker/dev/Dockerfile\n    volumes:\n        - ./papermerge:/core_app/papermerge/\n        - ./ui:/core_ui/\n    environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234  # top secret\n      PAPERMERGE__AUTH__USERNAME: admin\n      PAPERMERGE__AUTH__PASSWORD: 1234\n    ports:\n      - \"11000:80\"\n</code></pre>"},{"location":"contributor/docker/#web-app-worker","title":"Web App + Worker","text":"<p>Following docker compose adds worker service. Worker and Web App communicate via redis (message broker), thus we need to add redis service as well:</p> <pre><code>version: \"3.9\"\n\nx-backend: &amp;common  # yaml anchor definition\n  build:\n    context: .\n    dockerfile: docker/dev/Dockerfile\n  environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234  # top secret\n      PAPERMERGE__AUTH__USERNAME: admin\n      PAPERMERGE__AUTH__PASSWORD: 1234\n      PAPERMERGE__REDIS__URL: redis://redis:6379/0\n  volumes:\n      - ./papermerge:/core_app/papermerge/\n      - ./ui:/core_ui/\n      - data:/db\n      - index_db:/core_app/index_db\n      - media_root:/core_app/media\n\nservices:\n  web:\n    &lt;&lt;: *common\n    ports:\n     - \"11000:80\"\n    depends_on:\n      - redis\n  worker:\n    &lt;&lt;: *common\n    command: worker\n  redis:\n    image: redis:6\n\nvolumes:\n    data:\n    index_db:\n    media_root:\n</code></pre>"},{"location":"contributor/docker/#logging-config","title":"Logging Config","text":"<p>Both worker and web app read their logging configurations from file pointed by <code>PAPERMERGE__MAIN__LOGGING_CFG</code> environment variable. An example of custom logging config would be:</p> <pre><code>version: 1\ndisable_existing_loggers: true\n\nformatters:\n  verbose:\n    format: '%(asctime)s %(levelname)s %(name)s.%(funcName)s %(message)s'\n\nhandlers:\n  console:\n    level: DEBUG\n    class: logging.StreamHandler\n    formatter: verbose\n\nloggers:\n  auth_server:\n    level: DEBUG\n    handlers: [console]\n  papermerge.search.tasks:\n    level: DEBUG\n    handlers: [console]\n    propagate: no\n    format: verbose\n</code></pre> <p>You may recognize it. It should be YAML version of python logging config.</p> <p>Here is an example of docker compose with web wepp + worker + custom logging configuration:</p> <pre><code>version: \"3.9\"\n\nx-backend: &amp;common\n  build:\n    context: .\n    dockerfile: docker/dev/Dockerfile\n  environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234  # top secret\n      PAPERMERGE__AUTH__USERNAME: admin\n      PAPERMERGE__AUTH__PASSWORD: 1234\n      PAPERMERGE__REDIS__URL: redis://redis:6379/0\n      PAPERMERGE__MAIN__LOGGING_CFG: /logging.yml  # &lt;-- absolute path to custom config file\n  volumes:\n      - ./papermerge:/core_app/papermerge/\n      - ./ui:/core_ui/\n      - data:/db\n      - index_db:/core_app/index_db\n      - media_root:/core_app/media\n      - ./custom_logging.yml:/logging.yml  # mount local logging config file\n\nservices:\n  web:\n    &lt;&lt;: *common\n    ports:\n     - \"11000:80\"\n    depends_on:\n      - redis\n  worker:\n    &lt;&lt;: *common\n    command: worker\n  redis:\n    image: redis:6\n\nvolumes:\n    data:\n    index_db:\n    media_root:\n</code></pre>"},{"location":"contributor/docker/#solr","title":"Solr","text":"<p>Papermerge is shipped with a default search library - Xapian.</p> <p>However, you may opt-in to use full fledged search engine like Solr. In order to change search backend, use <code>PAPERMERGE__SEARCH__URL</code> env variable:</p> <pre><code>version: \"3.9\"\n\nx-backend: &amp;common\n  build:\n    context: .\n    dockerfile: docker/dev/Dockerfile\n  environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234\n      PAPERMERGE__AUTH__USERNAME: admin\n      PAPERMERGE__AUTH__PASSWORD: 1234\n      PAPERMERGE__REDIS__URL: redis://redis:6379/0\n      PAPERMERGE__SEARCH__URL: solr://solr:8983/pmg-index  # &lt;- use Solr's \"pmg-index\" index\n  volumes:\n      - ./papermerge:/core_app/papermerge/\n      - ./ui:/core_ui/\n      - data:/db\n      - index_db:/core_app/index_db\n      - media_root:/core_app/media\n\nservices:\n  web:\n    &lt;&lt;: *common\n    ports:\n     - \"11000:80\"\n    depends_on:\n      - redis\n      - solr\n  worker:\n    &lt;&lt;: *common\n    command: worker\n  redis:\n    image: redis:6\n  solr:\n    image: solr:9.3\n    ports:\n     - \"8983:8983\"\n    volumes:\n      - solr_data:/var/solr\n    command:\n      - solr-precreate\n      - pmg-index  # &lt;- creates index at startup of the Solr service\n\nvolumes:\n  data:\n  solr_data:\n  index_db:\n  media_root:\n</code></pre> <p>Notice that Solr is started with <code>solr-precreate pmg-index</code> command, which means that Solr service will be started with pre-created index named <code>pmg-index</code>.</p>"},{"location":"contributor/docker/#postgresql","title":"PostgreSQL","text":"<p>Here is an example of docker compose which uses PostgreSQL as database:</p> <pre><code>version: \"3.9\"\n\nx-backend: &amp;common\n  build:\n    context: .\n    dockerfile: docker/dev/Dockerfile\n  environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234  # top secret\n      PAPERMERGE__AUTH__USERNAME: admin\n      PAPERMERGE__AUTH__PASSWORD: 1234\n      PAPERMERGE__DATABASE__URL: postgresql://postgres:123@db:5432/postgres\n      PAPERMERGE__REDIS__URL: redis://redis:6379/0\n      PAPERMERGE__SEARCH__URL: solr://solr:8983/pmg-index\n  volumes:\n    - ./papermerge:/core_app/papermerge/\n    - ./ui:/core_ui/\n    - index_db:/core_app/index_db\n    - media_root:/core_app/media\n  depends_on:\n    - redis\n    - solr\n    - db\n\nservices:\n  web:\n    &lt;&lt;: *common\n    ports:\n     - \"11000:80\"\n  worker:\n    &lt;&lt;: *common\n    command: worker\n  redis:\n    image: redis:6\n  solr:\n    image: solr:9.3\n    ports:\n     - \"8983:8983\"\n    volumes:\n      - solr_data:/var/solr\n    command:\n      - solr-precreate\n      - pmg-index\n  db:\n    image: bitnami/postgresql:14.4.0\n    volumes:\n      - postgres_data:/var/lib/postgresql/data/\n    environment:\n      - POSTGRES_PASSWORD=123\n\nvolumes:\n  postgres_data:\n  solr_data:\n  index_db:\n  media_root:\n</code></pre>"},{"location":"contributor/docker/#oauth-20","title":"OAuth 2.0","text":""},{"location":"rest-api/overview/","title":"Overview","text":"<p>In order to use REST API interface you need an http client. The most wide-spread http client is curl.</p> <p>In following sections curl will be used if all examples.</p>"},{"location":"rest-api/overview/#server-url","title":"Server URL","text":"<p>Throughout this REST API documentation you will notice reference to <code>&lt;server-url&gt;</code> - this is base http address of your Papermerge instance. Base url/address is where your instance was deployed. Depending where your Papermerge instance was deployed you may use <code>https</code> instead of <code>http</code> and use correct port number.</p> <p>Examples of <code>&lt;server-url&gt;</code>:</p> <ul> <li>http://localhost:8000/</li> <li>https://example.com/</li> <li>https://my-app.papermerge.io/</li> </ul> <p>Let's take an example for authentication REST API. If your <code>&lt;server-url&gt;</code> is https://example-app.papermerge.io/ then, in order to authenticate and get a token you'll need to run following curl command:</p> <pre><code>curl -XPOST https://example-app.papermerge.io/api/auth/login/ \\\n-H 'Content-Type: application/json' \\\n-d '{\"username\":\"john\",\"password\":\"password\"}'\n</code></pre> <p>Another example, this time with users endpoint:</p> <pre><code>curl https://example-app.papermerge.io/api/users/ \\\n  -H 'Content-Type: application/vnd.api+json'\n  -H 'Authorization: Token ababfa840abb6b8aa3a185e631c19095c70de932'\n</code></pre> <p>Note</p> <p>When querying for json data types always pay attention to Content-Type header. For json data it sometimes may be either <code>application/json</code> or <code>application/vnd.api+json</code>. Each REST API call reference documents correct value of <code>Content-Type</code> header.</p>"},{"location":"rest-api/overview/#authentication","title":"Authentication","text":"<p>Papermerge REST API backend uses token based authentication, this means that you will need to send your credentials to the backend API server and if credentials are correct, then server's response will contain a valid token in response's body. For all subsequent requests, which require authorization, you will need to append <code>Authorization</code> header with <code>Token &lt;token&gt;</code> value.</p> <p>Tip</p> <p>After you've retrieved token for your account, all subsequent requests need to include <code>Authorization: Token &lt;token&gt;</code> header.</p> <p>For authentication use authentication endpoint. Example:</p> <pre><code>curl -X POST \\\n  &lt;server-url&gt;/api/auth/login/ \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"username\":\"john\",\"password\":\"&lt;password here&gt;\"}'\n</code></pre> <p>When credentials are correct, response will have status 200 OK, <code>content-type</code> will be <code>application/json</code> and response will have following body:</p> <pre><code>  {\n    \"token\": &lt;your token here&gt;,\n    \"expiry\": null\n  }\n</code></pre> <p>With authentication token at hand, you can perform any REST API, for example:</p> <pre><code>curl https://example.com/api/users/me/ \\\n  -H 'Content-Type: application/vnd.api+json'\n  -H 'Authorization: Token ababfa840abb6b8aa3a185e631c19095c70de932'\n</code></pre> <p>Note</p> <p>When quering for json data types always pay attention to    <code>Content-Type</code>. For json data it sometimes may be either    <code>application/json</code> or <code>application/vnd.api+json</code>. Each REST API call    reference documents correct value of <code>Content-Type</code> header.</p>"},{"location":"rest-api/overview/#nodes-folders-and-documents","title":"Nodes, Folders and Documents","text":"<p>This section explains by example how to use nodes, folders and documents endpoints because they feature some peculiarities.</p> <p>In Papermerge one folder can contain other folders and documents. It is de factor standard nowadays for a typical <code>file manager</code>_ to organize files and folders in hierarchical structure (i.e folder can contains other folders and files). In this regard Papermerge behaves like a common <code>file manager</code>.</p> <p>Our goal of this short tutorial like section is to create, with help of REST API, following structure of folders and documents:</p> <p></p> <p>In illustration above folder My Documents contains two folders and two documents:</p> <ul> <li>Fruits (folder)</li> <li>Vegetables (folder)</li> <li>mydoc_1.pdf</li> <li>mydoc_2.pdf</li> </ul> <p>Folder Fruits contains two documents: apples.pdf and lemons.pdf. Folder Vegetables contains just one document titled broccoli.pdf.</p> <p>Let's first create folder \"My Documents\".</p> <p>Each folder belongs to a specific user and has one parent folder - which means that in order to create folder \"My Documents\" we need to know parent folder id (user id is deduced from the token). Notice that folder \"My Documents\", which we are about to create, looks like it will be top level folder - which may lead you to wrong conclusion that \"My Documents\" folder does not need parent id.</p> <p>Important</p> <p>Every folder and document you create in Papermerge requires non empty folder parent id field.</p>"},{"location":"rest-api/overview/#special-folders","title":"Special Folders","text":"<p>Every user in Papermerge has two special folders:</p> <ul> <li><code>.home</code></li> <li><code>.inbox</code></li> </ul> <p>These folders are special because they are created during user's account creation and are always there as long user's account exists. You cannot delete <code>.home</code>, <code>.inbox</code> folders and you cannot alter their title (which starts with dot character). Folder \"My Documents\" must be direct child of either <code>.home</code> or <code>.inbox</code> folder.</p> <p>Note</p> <p>You can create \"My Documents\" folder directly in user's <code>.inbox</code>. However <code>.inbox</code> folder is intended for received document (e.g. via email attachments)</p> <p>In order to get user's <code>.home</code> folder id use <code>api/users/me/</code> endpoint::</p> <pre><code>curl &lt;server-url&gt;/api/users/me/ \\\n  -H 'Authorization: Token beb...'\n</code></pre> <p>Example of response:</p> <pre><code>  {\n    \"data\": {\n      \"type\": \"users\",\n      \"id\": \"169d8\",\n      \"attributes\": {\n        \"username\": \"admin\",\n        ...\n      },\n      \"relationships\": {\n        \"inbox_folder\": {\n          \"data\": {\n            \"type\": \"folders\",\n            \"id\": \"8d6ee1\"\n          }\n        },\n        \"home_folder\": {\n          \"data\": {\n            \"type\": \"folders\",\n            \"id\": \"18381e\"  // &lt;-- .home folder id\n          }\n        },\n      }\n    }\n  }\n</code></pre> <p>In response above home folder id is \"18381e\". folder id is actually an <code>uuid</code> number, however for sake of simplicity, we abbreviate it and remove all irrelevant fields.</p> <p>Important</p> <p>For creating folder and documents you always need parent folder id. User has two special folders: <code>.inbox</code> and <code>.home</code> and all other documents and folders are under one of these two folders. In order to get special folder's ids use <code>api/users/me/</code> REST API endpoint</p>"},{"location":"rest-api/overview/#create-folder","title":"Create Folder","text":"<p>Now, once we have folder's parent id, we can create \"My Documents\" folder:</p> <pre><code>  curl -XPOST &lt;server-url&gt;/api/folders/ \\\n    -H 'Authorization: Token beb...' \\\n    -H 'Content-Type: application/vnd.api+json' \\\n    -d '{\n      \"data\": {\n        \"type\": \"folders\",\n        \"attributes\": {\n          \"title\": \"My Documents\"\n        },\n        \"relationships\": {\n          \"parent\": {\n            \"data\": {\n                \"type\": \"folders\",\n                \"id\": \"18381e\"  // &lt;- .home folder id\n            }\n          }\n        }\n      }\n    }'\n</code></pre> <p>Similarly you can create folder with help of <code>POST /api/nodes/</code> endpoint:</p> <pre><code>  curl -XPOST &lt;server-url&gt;/api/nodes/ \\\n    -H 'Authorization: Token beb...' \\\n    -H 'Content-Type: application/vnd.api+json' \\\n    -d '{\n      \"data\": {\n        \"type\": \"folders\",\n        \"attributes\": {\n          \"title\": \"My Documents\"\n        },\n        \"relationships\": {\n          \"parent\": {\n            \"data\": {\n                \"type\": \"folders\",\n                \"id\": \"18381e\"  // &lt;- .home folder id\n            }\n          }\n        }\n      }\n    }'\n</code></pre> <p>We can create as many folders with same title as we want. Papermerge does not impose folder title uniqueness.</p> <p>Also it is important to note that when creating folder, <code>Content-Type: application/vnd.api+json</code> header must be used. If you forget to include <code>application/vnd.api+json</code> value for content-type you will get \"400 Bad Request\" response from REST API server.</p> <p>Important</p> <p>When content-type  is <code>application/vnd.api+json</code>, always wrap all fields inside \"data\" field:</p> <p>{     \"data\": {...}   }</p> <p>Note</p> <p>Even though you can use both endpoints i.e. <code>POST /api/nodes/</code> and <code>POST /api/folders/</code> for creating folders, we recommend to use <code>POST /api/nodes</code>. The point is, as you will see later, it make creating of folder and document consistent.</p>"},{"location":"rest-api/overview/#view-folders-content","title":"View Folder's Content","text":"<p>Once we've created folder \"My Documents\" under user's <code>.home</code>, we want to see what's inside <code>.home</code> folder, this way we can confirm that indeed folder \"My Documents\" was created and it is direct descendant of <code>.home</code> folder.</p> <p>Correct endpoint for listing the content of specific folder is <code>GET /api/nodes/{folder-id}/</code>. For our case, we want to list user's <code>.home</code>:</p> <pre><code>curl &lt;server-url&gt;/api/nodes/18381e/ \\\n  -H 'Authorization: Token beb...'\n</code></pre> <p>And response json body will look something like:</p> <pre><code>  {\n    \"links\": {\n      ...\n    },\n    \"data\": [\n      {\n        \"type\": \"folders\",\n        \"id\": \"949baf\",\n        \"attributes\": {\n          \"title\": \"My Documents\",\n          ...\n        },\n        \"relationships\": {\n          \"parent\": {\n            \"data\": {\n              \"type\": \"folders\",\n              \"id\": \"18381e\"\n            }\n          }\n        }\n      },\n      ...\n    ],\n    \"meta\": {\n      \"pagination\": {\n        ...\n      }\n    }\n  }\n</code></pre> <p>Node - is an abstraction of both folder and document, thus when we use <code>GET /api/nodes/{node-id}/</code> REST API endpoint we basically request to list all documents and folders under specific node-id.</p> <p>To be exact the correct signature of the endpoint is <code>GET /api/nodes/ {folder-id}/</code>, because it does not make any sense to list \"folders and documents under a document\".</p> <p>There two other endpoints which you may think of as a way to list all folder's content:</p> <ul> <li><code>GET /api/folders/</code></li> <li><code>GET /api/folders/{folder-id}/</code></li> </ul> <p>First one, <code>GET /api/folders/</code>, indeed will return all folders of specific user. However, it will return only folders and all folders will be listed as flat structure. In our case this means that folder \"My Documents\", <code>.home</code>, <code>.inbox</code> will be in the same flat list.</p> <p>Second one, <code>GET /api/folders/{folder-id}/</code>, will return folder's properties details i.e. id, title, tags, created_at etc</p> <p>Important</p> <p>Correct endpoint for listing the content of specific folder is <code>GET /api/nodes/{folder-id}/</code></p>"},{"location":"rest-api/overview/#create-document","title":"Create Document","text":"<p>At this point, creating \"Fruits\" and \"Vegetables\" folders should be straightforward and we leave it as exercise.</p> <p>Creating documents, on the other hand, needs clarification. First of all, from user point of view - documents are \"uploaded\", not \"created\". But from REST API point of view, uploading a document is performed in two steps:</p> <ol> <li>create document entry</li> <li>upload associated file</li> </ol> <p>In first step we create document entry:</p> <pre><code>curl -XPOST &lt;server-url&gt;/api/nodes/ \\\n  -H 'Authorization: Token beb...' \\\n  -H 'Content-Type: application/vnd.api+json' \\\n  -d '{\n    \"data\": {\n      \"type\": \"documents\",\n      \"attributes\": {\n        \"title\": \"mydoc_1.pdf\"\n      },\n      \"relationships\": {\n        \"parent\": {\n          \"data\": {\n              \"type\": \"folders\",\n              \"id\": \"18381e1\"\n          }\n        }\n      }\n    }\n  }'\n</code></pre> <p>Creating document entry in this way is very similar to creating a folder. The difference is that for documents you specify type \"documents\".</p> <p>At this point, if you list all documents and folders under \"My Document\", you will see folders \"Vegetables\", \"Fruits\" and document \"mydoc_1.pdf\". However, document \"mydoc_1.pdf\" does not have a file associated yet, in other words, we still need to upload file and associated it with \"mydoc_1.pdf\" document.</p> <p>This is second step. In order to perform second step we need to have a file and we need to know the id of the document entry we've just created. Document id can be retrieved either from response of <code>POST /api/nodes/</code> endpoint, or by listing all children nodes of \"My Documents\" folder with <code>GET /api/nodes/{my-documentsn-node-id}/</code>.</p> <p>Here is curl command to upload pdf file and associate it with given document id::</p> <p>curl -H 'Authorization: Token beb...' \\        -H 'Content-Disposition: attachment; filename=mydoc_1.pdf' \\        -H 'Content-Type: application/pdf' \\        -T /path/to/my_doc_1.pdf \\        http:///api/documents/{document-id}/upload/mydoc_1.pdf <p><code>-T</code> parameter in <code>curl</code> implies usage of <code>PUT</code>. Also, notice that <code>Content-Disposition: attachment; filename=&lt;file-name&gt;</code> is mandatory header.</p>"},{"location":"rest-api/overview/#summary","title":"Summary","text":"<ul> <li>Retrieve special folder ids with <code>GET /api/users/me/</code> endpoint</li> <li>Creating a node (document or folder) requires non-empty parent id</li> <li>Create a folder with <code>POST /api/nodes/</code> endpoint (type \"folders\")</li> <li>List content of the folder with <code>GET /api/nodes/</code> endpoint</li> <li> <p>Uploading document is two steps process:</p> </li> <li> <p>create document entry with <code>POST /api/nodes/</code> (type \"documents\")</p> </li> <li>upload file to document node created in first step using <code>PUT /api/documents/{document-id}/upload/file-name</code></li> </ul>"},{"location":"rest-api/reference/","title":"Reference","text":"<p>Papermerge REST API is exposed via Open API standard. which means that there is one <code>openapi-schema.yml</code> file that can be rendered by various 3rd party visualizers. <code>openapi-schema.yml</code> file is generated directly from application code and thus (at the time of generation) it matches actual implementation.</p> <p>Papermergeships with two \"REST API visualizers\" - redoc and swagger ui. Both of these \"visualizers\" read from same openapi schema file and thus convey same information - just formatted differently.</p>"},{"location":"rest-api/reference/#online-vs-local-instance","title":"Online vs Local Instance","text":"<p>As you will see, there are two ways of accessing REST API reference - one is from your own instance and another from online documentation website. Accessing REST API reference from your own Papermergeinstance's guarantees that the reference will match implementation, because in this case REST API reference is generated on the fly!</p> <p>On the other hand, online version of the REST API (i.e. <code>redoc ui</code> and <code>swagger ui</code>) reference uses <code>openapi-schema.yml</code> file generated beforehand which means that it may slightly differ from your own Papermergeinstance. Online REST API reference is there only for convenience.</p>"},{"location":"rest-api/reference/#redoc","title":"Redoc","text":"<p>Papermerge REST API online reference is available via <code>redoc ui</code>.</p> <p>Same reference can be accessed from your own Papermergeinstance using following URL:</p> <pre><code>    &lt;server-url&gt;/api/schema/redoc/\n</code></pre> <p>In case when you run Papermergelocally using default REST API server port use http://localhost:8000/api/schema/redoc/.</p> <p>Also, when you run your own instance of Papermergeyou can access redoc based REST API reference from user menu:</p> <p></p>"},{"location":"rest-api/reference/#swagger-ui","title":"Swagger UI","text":"<p>Papermerge REST API online reference is available via <code>swagger ui</code>.</p> <p>Same reference can be accessed from your own Papermergeinstance using following URL:</p> <pre><code>    &lt;server-url&gt;/api/schema/swagger-ui/\n</code></pre> <p>In case when you run Papermergelocally using default REST API server port use http://localhost:8000/api/schema/swagger-ui/.</p> <p>Also, when you run your own instance of Papermergeyou can access swagger based REST API reference from user menu:</p> <p></p>"},{"location":"settings/auth/","title":"Auth","text":""},{"location":"settings/auth/#auth__username","title":"AUTH__USERNAME","text":"<p>Username for the superuser. Default value is <code>admin</code>.</p> <p>Example:</p> <pre><code>PAPERMERGE__AUTH__USERNAME=john\n</code></pre>"},{"location":"settings/auth/#auth__password","title":"AUTH__PASSWORD","text":"<p>Password for the superuser. No default value.</p> <p>Example:</p> <pre><code>PAPERMERGE__AUTH__PASSWORD=topsecret\n</code></pre>"},{"location":"settings/auth/#auth__email","title":"AUTH__EMAIL","text":"<p>Email for the superuser. Default value is <code>admin@example.com</code>.</p> <p>Example:</p> <pre><code>PAPERMERGE__AUTH__EMAIL=john@mail.com\n</code></pre>"},{"location":"settings/database/","title":"Database","text":"<p>This sections is for database configurations. Papermerge supports following databases SQLite3, PostgreSQL, MySQL/MariaDB.</p>"},{"location":"settings/database/#database__url","title":"DATABASE__URL","text":"<p>For PostgreSQL the database URL is given in following format:</p> <pre><code>postgres://USER:PASSWORD@HOST:PORT/NAME\n</code></pre> <p>or</p> <pre><code>postgresql://USER:PASSWORD@HOST:PORT/NAME\n</code></pre> <p>Example:</p> <pre><code>postgresql://scott:tiger@db:5432/mydatabase\n</code></pre> <p>For MariaDB and MySQL the URL scheme is <code>mysql</code>.</p> <p>Example:</p> <pre><code>mysql://myuser:mypass@db:3306/paperdb\n</code></pre> <p>For SQLite the format is: <code>sqlite:///PATH</code>.</p> <p>Example:</p> <pre><code>sqlite:////db/db.sqlite3\n</code></pre> <p>Default value is <code>sqlite:////db/db.sqlite3</code>, in other words, if <code>DATABASE__URL</code> is missing, Papermerge will use SQLite with <code>/db/db.sqlite3</code> as db file.</p> <p>Note</p> <p>Both web_app and worker must have same <code>PAPERMERGE__DATABASE__URL</code>.</p>"},{"location":"settings/main/","title":"Main","text":""},{"location":"settings/main/#main__media_root","title":"MAIN__MEDIA_ROOT","text":"<p>Absolute filesystem path to the directory that will hold user-uploaded documents.</p> <p>Example:</p> <pre><code>PAPERMERGE__MAIN__MEDIA_ROOT=/var/www/example.com/media/\n</code></pre>"},{"location":"settings/main/#main__logging_cfg","title":"MAIN__LOGGING_CFG","text":"<p>Absolute filesystem path to the yaml file that will hold logging detailed configuration. Content of logging configuration file is expected to be in yaml format and it is very python specific.</p> <p>Example:</p> <pre><code>  PAPERMERGE__MAIN__LOGGING_CFG=/etc/papermerge/logging.yaml\n</code></pre>"},{"location":"settings/main/#main__timezone","title":"MAIN__TIMEZONE","text":"<p>Which timezone to use.</p> <p>Example:</p> <pre><code>PAPERMERGE__MAIN__TIMEZONE=Europe/Berlin\n</code></pre>"},{"location":"settings/ocr/","title":"OCR","text":"<p>This section groups all OCR specific configurations.</p>"},{"location":"settings/ocr/#ocr__default_language","title":"OCR__DEFAULT_LANGUAGE","text":"<p>By default Papermerge will use language specified with this option to perform OCR. Change this value for language used by majority of your documents. For detailed list of three letter codes see 639-2/T column from ISO 639 2.</p> <p>Example as environment variable:</p> <pre><code>PAPERMERGE__OCR__DEFAULT_LANGUAGE=spa\n</code></pre> <p>Default value is \"deu\" (German language).</p>"},{"location":"settings/overview/","title":"Overview","text":"<p>Papermerge loads its settings from environment variables.</p> <p>Environment variables have following format:</p> <pre><code>PAPERMERGE__&lt;section&gt;__&lt;name&gt;\n</code></pre> <p>double underscores are used as delimiter; environment variables names must be all upper case.</p> <p>Only required environment variables are:</p> <ul> <li>PAPERMERGE__SECURITY__SECRET_KEY</li> <li>PAPERMERGE__AUTH__PASSWORD</li> </ul> <p><code>PAPERMERGE__SECURITY__SECRET_KEY</code> is the key to securing signed data \u2013 it is vital you keep this secure, or attackers could use it to generate their own signed values.</p> <p><code>PAPERMERGE__AUTH__PASSWORD</code> is the password for super user (administrative user or admin user). Super user is created automatically for you when Papermerge starts for the first time.</p> <p>Note</p> <p>In the documentation, for brevity sake, <code>PAPERMERGE__</code> prefix may be omitted. For example docs may say: default value for <code>DATABASE__URL</code> is \"sqlite:////db/db.sqlite3\"; what is meant actually is: default value for <code>PAPERMERGE__DATABASE_URL</code> is \"sqlite:////db/db.sqlite3\".</p>"},{"location":"settings/redis/","title":"Redis","text":"<p>Papermerge uses redis.</p>"},{"location":"settings/redis/#redis__url","title":"REDIS__URL","text":"<p>For Redis the URL is given in following format:</p> <pre><code>redis://HOST:PORT/NUMBER\n</code></pre> <p>For example:</p> <pre><code>redis://redis:6379/0\n</code></pre> <p>Note</p> <p>Both web_app and worker must have same <code>PAPERMERGE__REDIS__URL</code></p>"},{"location":"settings/search/","title":"Search Engine","text":"<p>Papermerge supports multiple search engine backends. Currently two backends are available:</p> <ul> <li>xapian</li> <li>solr</li> </ul>"},{"location":"settings/search/#search__url","title":"SEARCH__URL","text":"<p>Search engine backend to use. For Solr format is:</p> <pre><code>solr://HOST:PORT/INDEX\n</code></pre> <p>Example: <code>solr://solr:8983/pmg-index</code></p> <p>For Xapian URL format is <code>xapian:///PATH</code>. Example: <code>xapian:////index_db</code> - in other words, xapian will store all index data in <code>/index_db</code> folder.</p> <p>Default value for <code>PAPERMERGE__SEARCH__URL</code> is <code>xapian:////index_db</code></p> <p>Note</p> <p>Both web_app and worker must have same <code>PAPERMERGE__SEARCH__URL</code></p>"},{"location":"settings/security/","title":"Security","text":""},{"location":"settings/security/#security__secret_key","title":"SECURITY__SECRET_KEY","text":"<p> Required . Unique secret key. The secret key must be a large random value and it must be kept secret. This option does not have default value, you always need to supply a value for it. Secret key is used to sign JWT tokens.</p> <p>Example as environment variable:</p> <pre><code>PAPERMERGE__SECRET__SECRET_KEY=asjrijfpHHJH00huge00secret00QMNB344GHOOooaq\n</code></pre>"},{"location":"setup/add-ocr-langs/","title":"Add OCR Languages","text":"<p>By default the Papermerge Docker image includes English, German, French, Italian, Spanish, Romanian and Portugues OCR languages.</p> <p>You can install extra languages by creating a new docker image from base <code>papermerge/papermerge</code>.</p> <p>Create new docker file with following content:</p> <pre><code>FROM papermerge/papermerge:3.0dev20\n\n# add Danish and Polish OCR languages\nRUN apt install tesseract-ocr-dan tesseract-ocr-pol\n</code></pre> <p>All languages are specified in three letters code as per ISO 639-2T standard - second column in the table.</p> <p>In order to build your image run:</p> <pre><code>docker build -t mypaper:3.0 -f Dockerfile .\n</code></pre> <p>Check that OCR languages were installed:</p> <pre><code>docker run -it --rm  mypaper:3.0  tesseract --list-langs\n</code></pre>"},{"location":"setup/ansible/","title":"Ansible","text":"<p>Warning</p> <p>Papermerge 3.0 is currently in active development. There is no stable version yet for 3.0. At this stage all docker images are tagged either 3.0devX or 3.0aX.</p> <p>Version 3.0 is set to be officially released (i.e. tagged with 3.0) by the end of December 2023</p>"},{"location":"setup/ansible/#ansible","title":"Ansible","text":"<p>Ansible playbook is available at papermerge/ansible.</p> <p>Playbook will install web app, one worker, database, Redis and Solr search engine on target host. All services will be started via docker containers.</p> <p>Inventory file is not provided in the repository, you will need to create one. Here is an example of inventory file:</p> <pre><code>192.168.56.99 secret_key=abc superuser_password=1234 superuser_username=eugen database_url=\"postgresql://scott:tiger@db/mydatabase\"  db_pass=tiger\n</code></pre> <p>Playbook was tested in vagrant environment, with Ubuntu 22.04 as target host. Ansible config file is not in repository, you need to create one. Here is an example of Ansible config file:</p> <pre><code>[defaults]\ninventory = inventory\nhost_key_checking = False\ndeprication_warnings = False\nremote_user = vagrant\nprivate_key_file = .vagrant/machines/default/virtualbox/private_key\n</code></pre> <p>All other variables, with their defaults are in <code>group_vars/all</code> file.</p>"},{"location":"setup/ansible/#install","title":"Install","text":"<p>To install Papermerge, simply run <code>install.yml</code> playbook:</p> <pre><code>ansible-playbook -i inventory install.yml\n</code></pre> <p>After installation is complete, the application will be available at:</p> <pre><code>http://&lt;target-host&gt;:&lt;web_app_port&gt;\n</code></pre> <p><code>web_app_port</code> variable is in <code>group_vars/all</code> file. The <code>web_app_port</code> default value is 9400.</p>"},{"location":"setup/ansible/#backup","title":"Backup","text":"<p>On the target host, folder <code>/backup</code> is mounted to web_app's container folder <code>/backup</code>.</p> <p>In order to create a backup, run following playbook:</p> <pre><code>ansible-playbook -i inventory backup.yml\n</code></pre> <p>Above command will create backup file in  <code>/backup/</code> in web app's folder, but because that folder is mounted by default to target VM host, you will see backup archive available in <code>/backup/</code> folder of host VM as well.</p>"},{"location":"setup/ansible/#restore","title":"Restore","text":"<p>To restore a backup, run following playbook:</p> <pre><code>ansible-playbook restore.yml --extra-vars \"backup_file=/backup/backup_20_11_2023-07_33_03.tar.gz\"\n</code></pre> <p>File path is one from web app's docker container.</p>"},{"location":"setup/ansible/#contribute","title":"Contribute","text":"<p>As mentioned above, currently playbook assumes only Ubuntu 22.04 host. We are happy to accept your pull requests for other hosts.</p> <p>Ansible playbook repository is available at papermerge/ansible.</p>"},{"location":"setup/docker-compose/","title":"Docker Compose","text":"<p>This section describes how to setup Papermerge using docker compose.</p>"},{"location":"setup/docker-compose/#web-app-worker","title":"Web App + Worker","text":"<p>The simpliest docker compose setup for Papermerge is following:</p> <pre><code>  version: \"3.9\"\n\n  x-backend: &amp;common\n    image: papermerge/papermerge:3.0dev20\n    environment:\n        PAPERMERGE__SECURITY__SECRET_KEY: 12345\n        PAPERMERGE__AUTH__USERNAME: john\n        PAPERMERGE__AUTH__PASSWORD: hohoho\n        PAPERMERGE__REDIS__URL: redis://redis:6379/0\n    volumes:\n        - data:/db\n        - index_db:/core_app/index_db\n        - media:/core_app/media\n  services:\n    web:\n      &lt;&lt;: *common\n      ports:\n       - \"12000:80\"\n      depends_on:\n        - redis\n    worker:\n      &lt;&lt;: *common\n      command: worker\n    redis:\n      image: redis:6\n  volumes:\n    data:\n    index_db:\n    media:\n</code></pre> <p>You can access Papermerge user interface using any modern web browser (e.g. Firefox, Chrome). Open your web browser and point it to http://localhost:12000.</p>"},{"location":"setup/docker-compose/#postgresql","title":"PostgreSQL","text":"<p>By default Papermerge uses sqlite3 database. Here is setup to which uses PostgreSQL:</p> <pre><code>  version: \"3.9\"\n\n  x-backend: &amp;common\n    image: papermerge/papermerge:3.0dev20\n    environment:\n        PAPERMERGE__SECURITY__SECRET_KEY: 12345\n        PAPERMERGE__AUTH__USERNAME: john\n        PAPERMERGE__AUTH__PASSWORD: hohoho\n        PAPERMERGE__DATABASE__URL: postgresql://scott:tiger@db:5432/mydatabase\n        PAPERMERGE__REDIS__URL: redis://redis:6379/0\n    volumes:\n      - index_db:/core_app/index_db\n      - media:/core_app/media\n  services:\n    web:\n      &lt;&lt;: *common\n      ports:\n       - \"12000:80\"\n      depends_on:\n        - redis\n        - db\n    worker:\n      &lt;&lt;: *common\n      command: worker\n    redis:\n      image: redis:6\n    db:\n      image: bitnami/postgresql:14.4.0\n      volumes:\n        - postgres_data:/var/lib/postgresql/data/\n      environment:\n        POSTGRES_USER: scott\n        POSTGRES_PASSWORD: tiger\n        POSTGRES_DB: mydatabase\n  volumes:\n    postgres_data:\n    index_db:\n    media:\n</code></pre>"},{"location":"setup/docker-compose/#solr","title":"Solr","text":"<p>By default Papermerge uses Xapian search engine. However, for production environments, full fledged search engine like Solr is recommanded.</p> <pre><code>version: \"3.9\"\n\nx-backend: &amp;common\n  image: papermerge/papermerge:3.0dev20\n  environment:\n    PAPERMERGE__SECURITY__SECRET_KEY: 12345\n    PAPERMERGE__AUTH__USERNAME: john\n    PAPERMERGE__AUTH__PASSWORD: hohoho\n    PAPERMERGE__DATABASE__URL: postgresql://scott:tiger@db:5432/mydatabase\n    PAPERMERGE__REDIS__URL: redis://redis:6379/0\n    PAPERMERGE__SEARCH__URL: solr://solr:8983/pmg-index\n  volumes:\n    - media:/core_app/media\n\nservices:\n  web:\n    &lt;&lt;: *common\n    ports:\n     - \"12000:80\"\n    depends_on:\n      - redis\n      - db\n      - solr\n  worker:\n    &lt;&lt;: *common\n    command: worker\n  redis:\n    image: redis:6\n  db:\n    image: bitnami/postgresql:14.4.0\n    volumes:\n      - postgres_data:/var/lib/postgresql/data/\n    environment:\n      POSTGRES_USER: scott\n      POSTGRES_PASSWORD: tiger\n      POSTGRES_DB: mydatabase\n  solr:\n    image: solr:9.3\n    ports:\n     - \"8983:8983\"\n    volumes:\n      - solr_data:/var/solr\n    command:\n      - solr-precreate\n      - pmg-index\n\nvolumes:\n  postgres_data:\n  solr_data:\n  media:\n</code></pre>"},{"location":"setup/docker-compose/#mysql-mariadb","title":"MySQL / MariaDB","text":"<p>Here is an example of docker compose setup with MariaDB:</p> <pre><code>version: \"3.9\"\n\nx-backend: &amp;common\n  image: papermerge/papermerge:3.0dev20\n  environment:\n      PAPERMERGE__SECURITY__SECRET_KEY: 1234  # top secret\n      PAPERMERGE__AUTH__USERNAME: eugen\n      PAPERMERGE__AUTH__PASSWORD: 1234\n      PAPERMERGE__DATABASE__URL: mysql://myuser:mypass@db:3306/paperdb\n      PAPERMERGE__REDIS__URL: redis://redis:6379/0\n      PAPERMERGE__SEARCH__URL: solr://solr:8983/pmg-index\n  volumes:\n    - media_root:/core_app/media\n  depends_on:\n    - redis\n    - solr\n    - db\n\nservices:\n  web:\n    &lt;&lt;: *common\n    ports:\n     - \"11000:80\"\n  worker:\n    &lt;&lt;: *common\n    command: worker\n  redis:\n    image: redis:6\n  solr:\n    image: solr:9.3\n    ports:\n     - \"8983:8983\"\n    volumes:\n      - solr_data:/var/solr\n    command:\n      - solr-precreate\n      - pmg-index\n  db:\n    image: mariadb:11.2\n    volumes:\n      - maria:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: mypass\n      MYSQL_DATABASE: paperdb\n      MYSQL_USER: myuser\n      MYSQL_PASSWORD: mypass\nvolumes:\n  maria:\n  solr_data:\n  media_root:\n</code></pre>"},{"location":"setup/docker-compose/#oauth-20","title":"OAuth 2.0","text":"<p>...</p>"},{"location":"setup/docker/","title":"Docker","text":""},{"location":"setup/docker/#web-app","title":"Web App","text":"<p>The only two required environment variables are <code>PAPERMERGE__SECURITY__SECRET_KEY</code> and <code>PAPERMERGE__AUTH__PASSWORD</code>. To start web ui part use following command:</p> <pre><code>docker run -p 9400:80 \\\n    -e PAPERMERGE__SECURITY__SECRET_KEY=abc \\\n    -e PAPERMERGE__AUTH__PASSWORD=123 \\\n    papermerge/papermerge:3.0dev20\n</code></pre> <p>Point your web browser to <code>http://localhost:9400</code> and you will see login screen:</p> <p></p> <p>Credentials are:</p> <ul> <li>username <code>admin</code></li> <li>password <code>123</code></li> </ul> <p>Note</p> <p>The above <code>docker run</code> starts only web UI part. For complete setup you also need one or multiple workers.</p>"},{"location":"setup/docker/#official-docker-image","title":"Official Docker Image","text":"<p>Official Papermerge docker image is available on docker hub.</p>"},{"location":"setup/docker/#get-docker-image","title":"Get Docker Image","text":"<p>The recommended way to get the Papermerge docker image is via docker pull command:</p> <pre><code>docker pull papermerge/papermerge:3.0dev20\n</code></pre>"},{"location":"setup/docker/#web-app-worker","title":"Web App + Worker","text":"<p>For complete setup you need to start one or multiple workers. Worker is the component which, among other things, performs OCR.</p> <p>Here is minimal docker compose file with web UI and one worker:</p> <pre><code>  version: \"3.9\"\n\n  x-backend: &amp;common\n    image: papermerge/papermerge:3.0dev20\n    environment:\n        PAPERMERGE__SECURITY__SECRET_KEY: 12345\n        PAPERMERGE__AUTH__USERNAME: john\n        PAPERMERGE__AUTH__PASSWORD: hohoho\n        PAPERMERGE__REDIS__URL: redis://redis:6379/0\n    volumes:\n        - data:/db\n        - index_db:/core_app/index_db\n        - media:/core_app/media\n  services:\n    web:\n      &lt;&lt;: *common\n      ports:\n       - \"12000:80\"\n      depends_on:\n        - redis\n    worker:\n      &lt;&lt;: *common\n      command: worker\n    redis:\n      image: redis:6\n  volumes:\n      data:\n      index_db:\n      media:\n</code></pre> <p>With above setup, web app is accessible on  <code>http://localhost:12000</code>.</p>"},{"location":"setup/kubernetes/","title":"Kubernetes","text":"<p>To be added soon...</p>"},{"location":"setup/overview/","title":"Overview","text":""},{"location":"setup/overview/#web-app-and-worker","title":"Web App and Worker","text":"<p>Papermerge consists of one web app and multiple workers (at least one). The web app is the one which you see in your browsers or interact via REST API. The worker (one or multiple) is the part which performs background tasks like OCR, updating search engine index etc.</p>"},{"location":"setup/overview/#database","title":"Database","text":"<p>In order to function Papermerge needs a database, which can be one of following:</p> <ul> <li>SQLite</li> <li>PostgreSQL</li> <li>MySQL (MariaDB)</li> </ul> <p>By default Papermerge uses SQLite.</p>"},{"location":"setup/overview/#search-engine","title":"Search Engine","text":"<p>Papermerge supports multiple search engine backends:</p> <ul> <li>Xapian</li> <li>Apache Solr</li> </ul> <p>Xapian is used by default.</p>"},{"location":"setup/overview/#ocr","title":"OCR","text":"<p>Papermerge uses Tesseract to perform Optical Character Recognition.</p>"},{"location":"setup/requirements/","title":"Requirements","text":""},{"location":"setup/requirements/#software","title":"Software","text":"<p>Papermerge is designed to run on Linux/Unix compatible system.</p> <p>You need to have docker installed, as Papermerge is shipped as docker image. All docker images are stored on docker hub.</p> <p>Make sure that you have docker available:</p> <pre><code>    $ docker --version\n    Docker version 24.0.3, build 3713ee1\n</code></pre>"},{"location":"setup/requirements/#hardware","title":"Hardware","text":"<p>Hardware specification for Papermerge depends on number of documents and users.</p> <p>For one user with 1000-2000 pages a system spec with:</p> <ul> <li>2 CPU at 2.8GHz clock</li> <li>2 GB RAM</li> <li>25 GB Storage</li> </ul> <p>will do just fine.</p> <p>For OCR, Papermerge uses Tesseract. OCR is very CPU intensive operation, thus more CPUs and RAM memory your system has - better. More CPU cores and more powerful the CPUs means OCR will be performed faster.</p> <p>Note<p>GPU is not required as Tesseract runs OCR entirely on your CPU.</p> </p> <p>Testing system for Papermerge has following specs:</p> <ul> <li>Ubuntu 22.04</li> <li>8 Core i7 2.8GHz CPU</li> <li>16 GB RAM</li> <li>50 GB storage</li> </ul>"},{"location":"user/apps/","title":"Apps","text":"<p>From the very beginning of its existence, Papermerge started to receive features requests. Many of those requests made perfect sense and were implemented (or will be implemented). It is thanks to the  community's feedback and contributions that Papermerge evolves naturally into a mature archives management system.</p> <p>However, a great number of features requests were subject to debate, or just not suitable for majority of users. A very good example of such feature is duplicates removal. First of all, how to define that a specific document is a duplicate (of other document)?</p> <p>There are at least three possibilities:</p> <ol> <li>duplicate are documents with same file name</li> <li>duplicates are documents with same digest value</li> <li>duplicates are those documents where extracted text is &gt;= 95% similar (i.e. very similar)</li> </ol> <p>Each of points above has pros and cons. Each of them may be right under specific circumstances and for specific user or company requirements. By default, Papermerge does not implement any of those points. Event more, if you upload same files (with same content and even same filename) it will gladly accept them. In the end, whole this document duplicates thingy is just a matter of preference.</p> <p>Apps were introduced to address such issues. App (or plugin if you like) is a way extend base Papermerge application. Continuing with above example with document duplicates, by adding/removing specific Papermerge app you can add/remove specific document duplicate detection criteria. This way, Papermerge base application, which is called Papermerge Core will contain only essential features.</p>"},{"location":"user/apps/#papermerge-core","title":"Papermerge Core","text":"<p>On the other hand, document management system are complex applications, with rich set of requirements such as LDAP authentication, document electronic signatures and even such fancy things as data retention policies. Not everybody needs LDAP authentication though. Also, not everybody uses document electronic signatures and data retention policies. These type of features are very good candidates for Papermerge apps. All non essential features will be implemented as apps which can be easily plugged or removed.</p>"},{"location":"user/apps/#apps_1","title":"Apps","text":"<p>Papermerge app is basically a Django app with few extras. You may wonder what is Django app anyway? First of all, Papermerge is build with help of web framework called Django. Secondly, Papermerge project is a Django project which in turn is a loose collection of Django apps plus (project) settings. Figure 1 illustrates this idea.</p> <p></p> <p>Notice that Papermerge Core app is part of every Papermerge project.</p>"},{"location":"user/apps/#writing-basic-app","title":"Writing Basic App","text":"<p>The gory details of how to develop apps and include them into papermerge project are explained in contributing guide. Here, in user manual, only high level concepts are explained.</p> <p>Let's consider an app which will detect file name duplicates i.e. an app which if used, will issue an error when user tries to upload twice documents with same file names. Keep in mind that here the goal is to familiarize with general concepts.</p> <p>Inside Papermerge project create a new django app:</p> <pre><code>./manage.py startapp filebased_unique\n</code></pre> <p>To highlight that filebased_unique app is part of papermerge ecosystem, it will be moved into a namespace papermerge (which is just an extra folder):</p> <pre><code>$ mkdir papermerge\n$ mv filebased_unique papermerge/\n</code></pre> <p>Also, change <code>name</code> and <code>label</code> app attributes as shown below:</p> <pre><code>from django.apps import AppConfig\n\n\nclass FilebasedUniqueConfig(AppConfig):\n    name = 'papermerge.filebased_unique'\n    label = 'filebased_unique'\n</code></pre> <p>The heart of papermerge.filebased_unique app is file papermerge/filebased_unique/models.py where core document model is extended as following:</p> <pre><code>from django.core.exceptions import ValidationError\nfrom papermerge.core.models import Document, AbstractDocument\n\n\nclass DocumentPart(AbstractDocument):\n\n    def clean(self):\n\n        file_name = self.get_file_name()\n\n        if Document.objects.filter(file_name=file_name).count() &gt; 1:\n            raise ValidationError(\n                \"Document file_name duplicates detected\"\n            )\n</code></pre> <p>Here is link to app code on GitHub.</p>"},{"location":"user/apps/#document-parts","title":"Document Parts","text":"<p>Apps are there not just for adding extra validations, you can add extra fields to the core document as well.</p> <p>For example, in case you want to add a special UUID field to the document model, you can:</p> <pre><code>import uuid\nfrom django.db import models\n\nfrom papermerge.core.models import AbstractDocument\n\n\nclass DocumentPart(AbstractDocument):\n\n    special_uuid = models.UUIDField(\n        default=uuid.uuid4,\n        editable=False\n    )\n</code></pre> <p>Those extra fields added by apps to core document model - are called document parts. Papermerge application treats core document fields and those extra fields added by apps as one whole:</p> <p></p> <p>This way, any user or company, can extend core document model with whatever number of custom fields they wish without interfering with core application code.</p>"},{"location":"user/apps/#document-widgets","title":"Document Widgets","text":"<p>Note</p> <p>This feature is experimental.</p> <p>Each document part (i.e all those extra fields) will be visualized as widgets on the right side widget panel along with metadata widget and basic info widget.</p>"},{"location":"user/file-formats/","title":"File Formats","text":"<p>Papermerge supports PDF, TIFF, JPEG and PNG file formats.</p> <p>PDF format is called native because Papermerge interals operate as if all documents are PDF.</p> <p>TIFF, JPEG or PNG on the other hand are not native (non-native) formats.</p> <p>The import of native format yields one version document - the PDF itself i.e. orignal version.</p> <p>The import of any non-native formats yields two versions document:</p> <ul> <li>version 1 with non-native file i.e. original file</li> <li>version 2 with PDF file into which non-native format was converted</li> </ul> <p>Note<p>At its core Papermerge code is written to work with PDF files only. All other files (non-natives) are converted, on import, into PDF format.</p> </p>"},{"location":"user/getting-started/","title":"Getting Started","text":"<p>In this part of the documentation we define important concepts used Papermerge parlance. We highly recommend you to read and understand this section.</p>"},{"location":"user/getting-started/#document","title":"Document","text":"<p>For Papermerge a document is anything which is a good candidate for archiving - some piece of information which is not editable but you need to store it for future reference. For example receipts - you don't need to edit receipts or read them everyday, but eventually you will need them for your tax declaration. In this sense - scanned documents, which are usually in PDF, JPEG or TIFF format, are perfect match.</p> <p>If you take a picture of a paper document with your mobile phone - you'll have a file in jpeg format (or maybe png file format). In context of Papermerge that picture of a document (though just a single jpeg file) is a valid one page document.</p> <p>On the other hand, if you take a picture of a flower and upload that jpeg image to Papermerge - the 'document' will be processed. However, that jpeg format flower image is not a document in Papermerge sense.</p> <p></p> <p>Usually office formats with .docx (Microsoft Word), .odt (Libre Office), .txt (plain text) are not good candidates for archiving - as by their nature they are meant to be changed/edit regularly. However, once converted to PDF format (for instance Contract_C2.docx to Contract_C2.pdf) they are full fledged documents in Papermerge sense.</p> <p>Info</p> <p>Papermerge works with four file formats: PDF, TIFF, JPEG and PNG.</p>"},{"location":"user/getting-started/#document-version","title":"Document Version","text":"<p>One document has one or multiple versions. The original document version - is version number 1. For every change applied to the document - a new document version is created with that change applied.</p> <p>When we say \"change applied to a document\" - we mean things like rotate pages, reorder pages or merge two documents.</p> <p>The point of document versions is to keep track of changes applied to the document.</p>"},{"location":"user/getting-started/#folder","title":"Folder","text":"<p>Folder in Papermerge is counterpart of \"folder\" concept used in major computer file manager applications (e.g. Finder in macOS). Folders in Papermerge are, intuitively enough, hierarchical - in other words one folder may contain other folders and/or documents.</p>"},{"location":"user/getting-started/#node","title":"Node","text":"<p>Node is an abstraction of two concepts: document and folder. Every time you read node, you can mentally replace that term with either document or folder and the statement will still hold.</p> <p>Bellow is graphical example of Folder, Document, Document Version relationship:</p> <p></p> <p>Same hierarchy can be illustrated as nodes:</p> <p></p>"},{"location":"user/getting-started/#special-folders","title":"Special Folders","text":"<p>Each user in Papermerge has two special folders: Inbox and Home.</p> <p>Inbox folder is where all incoming documents land first. Home folder is where all user documents are.</p> <p>Special folders are top level folders (they don't have parent folder).</p> <p></p> <p>Note</p> <p>Both <code>Inbox</code> and <code>Home</code> folders are special only by convention; structurally they are just normal folders. Internally their title is actually \".inbox\" and \".home\". By convention special folders start with dot character.</p>"},{"location":"user/getting-started/#ocr","title":"OCR","text":"<p>OCR (Optical Character Recognition) is a technique to extract text information from binary image formats. This technique enables users to:</p> <ul> <li>copy/paste  text from the document's content</li> <li>search documents by document's actual text content</li> </ul> <p>OCR is essential tool (or technique if you will) which helps basically to extract textual information and thus derive useful work-flows (based on document's actual content) with the documents. Papermerge relies on external open source specialized tools like Google's Tesseract OCR</p>"},{"location":"user/getting-started/#tags","title":"Tags","text":"<p>Organizing documents in folders is very common. Thus the idea of keeping your documents in folders doesn't need further introduction. The idea of using tags to organize your documents may be new for you though. Tags are kind of labels. You can associate tags to a document or to a folder. Tags have a color and a name.</p> <p></p> <p>Once tagged, documents can be searched by their tags. Conversely, is it also possible to show all the documents tagged with a particular tag(s).</p> <p>Both tags and folders complement each other and provide you with powerful means to stay organized.</p>"},{"location":"user/getting-started/#page-management","title":"Page Management","text":"<p>Many times scanning documents in bulk yields documents with blank pages; some pages my be out of order, rotated, maybe part of totally different document. Even if you notices these flaws immediately it is time consuming and frustrating to redo scanning process. Papermerge helps you with your scanned documents like no other tool. With Papermerge you can reorder, rotate or even delete pages in case you need to do so.</p> <p></p> <p>There is a separate chapter about page management where you can learn details about this feature.</p>"},{"location":"user/merge-documents/","title":"Merge Documents","text":"<p>Let's first clarify what is meant by documents merging. Merging is the process of combining two documents into one: all pages from the source document are transferred into destination document and then source document is deleted.</p> <p>On the target document, transferred pages can:</p> <ol> <li>entirely replace target pages</li> <li>be appended to the target pages</li> </ol> <p>The rest of this documentation chapter describes how to use Papermerge in case 1. For how to use Papermerge in case 2, see :ref:<code>Page Moving &lt;page_move&gt;</code>.</p>"},{"location":"user/merge-documents/#1-source-pages-replace-target-pages","title":"1. Source pages replace target pages","text":"<p>Figure 1 illustrate this case. Both source (better_scan.pdf) and target (scan_d.pdf) documents have only one version (v1). Both source and target have two pages.</p> <p>In this case merge result is that in scan_d.pdf document there is a new version created (v2) and new version contains only source pages (BS1 and BS2). Previous pages of scan_d.pdf document (D1, D2) are still available in version 1 (v1 in figure) of the document.</p> <p></p> <p>This use case is useful when you scan same document twice and for some reason you want to keep both copies around. Because both copies contain slightly different versions of the same document, it is more practical to keep them as two document versions in one single file. In such case you will avoid duplicate results in search results.</p>"},{"location":"user/merge-documents/#2-source-pages-are-appended-to-the-target-pages","title":"2. Source pages are appended to the target pages","text":"<p>Figure 2 illustrate this case. Both source (better_scan.pdf) and target (scan_d.pdf) documents have only one version (v1). Also, both source and target have two pages.</p> <p>In this case result is that in scan_d.pdf document there is a new version created (v2) and new version contains now four pages: BS1, BS2, D1, D2. Previous version of scan_d.pdf document (v1) has contains two pages: D1 and D2.</p> <p></p> <p>This scenario is special case of 'moving pages' between documents with all pages selected on the source. How to use Papermerge in this scenario is described in detail in Moving Pages section.</p> <p>Important</p> <p>When merging two documents, one of them (source) is deleted. That's why, it is very important that when you merge two documents, you correctly choose which one is the source and which one is the target.</p> <p>Now, that you understand what is meant exactly by \"document merging\", let's see how you can merge document with Papermerge.</p>"},{"location":"user/merge-documents/#dual-panel","title":"Dual Panel","text":"<p>In order to merge two documents in Papermerge you need to open each of them in two panels:</p> <p></p> <p>In one of the panels, the one which you want to be the source, right click the mouse button to open the context menu.</p> <p>Important</p> <p>Merge Documents context menu item will be displayed only if there are no selected pages.</p> <p></p> <p>In Figure 3, notice the direction of the arrow icon just before \"Merge Document\". The arrow icon points from source to the target. In Figure 3, context menu was opened in left panel, this means that document opened in left panel (better_scan.pdf) is the source. On the other hand if we would open context menu in right panel, then the arrow will point from right to left - which also implies that in such case document opened in the right panel would be the source.</p> <p>Click the \"Merge Document\" context menu item. After you confirm the operation, the source document (better_scan.pdf) will be merged with scan_d.pdf.</p> <p></p>"},{"location":"user/ocr/","title":"OCR","text":"<p>OCR is the process which extracts text information from the scanned document and makes them searchable.</p> <p>By default, ocr process is triggered automatically on document file upload. The OCR process status is indicated by little circle next to document's title. When OCR process is completed new document version is created and document becomes searchable.</p>"},{"location":"user/ocr/#automatic-ocr","title":"Automatic OCR","text":"<p>By default OCR is triggered automatically when document is uploaded. However, you can disable automatic OCR triggering, in such case you can start OCR only when you consider necessary.</p> <p>Important</p> <p>Documents for which OCR was skipped - are not searchable!</p> <p>In order to disable automatic OCR, go to User Menu -&gt; Preferences -&gt; OCR -&gt; Trigger -&gt; Manual</p>"},{"location":"user/ocr/#default-ocr-language","title":"Default OCR Language","text":"<p>In order to perform OCR on the document you need to indicate beforehand the language of respective document. Choosing ocr language for each and every document uploaded is tedious - instead, in preferences a default OCR Language is set - and that language is applied for each uploaded document.</p> <p>In order to set default OCR language, go to User Menu -&gt; Preferences -&gt; OCR -&gt; Language</p>"},{"location":"user/ocr/#status-indicator","title":"Status Indicator","text":"<p>Papermerge features real time OCR status indicator - this means that you can see document's OCR status updates as they happen (i.e. in real time). The OCR status is displayed by a small circle next to the document's title. The status indicates has following meanings:</p> <ul> <li>gray circle - status is unknown (figure 1)</li> <li>orange still circle - document was scheduled for OCR (figure 2)</li> <li>orange rotating circle - document's OCR process is in progress (figure 3)</li> <li>green check - document's OCR process completed successfully and document is now searchable (figure 4)</li> <li>red cross - document's OCR process failed.</li> </ul> <p> </p>"},{"location":"user/ocr/#ocred-text-layer","title":"OCRed Text Layer","text":"<p>Once OCR process completed successfully a new document version is created - version with OCRed text layer. This version is available for download from the <code>Download</code> dropdown in document view.</p> <p></p> <p>Note</p> <p>Under the hood Papermerge uses awesome OCRmyPDF utility to create   OCRed text layer. Thus, in respect of OCRed text layer, Papermerge acts   like a graphical user interface for OCRmyPDF.</p>"},{"location":"user/ocr/#document-ocred-text","title":"Document OCRed Text","text":"<p>You can view OCRed text of the entire document either from commander or from viewer, in both cases choose \"OCRed Text\" from context menu:</p> <p></p> <p>If you want to see OCRed text of entire document (to be exact - all pages of the last document version) from the viewer - just make sure that no pages are selected:</p> <p></p>"},{"location":"user/ocr/#selected-pages-ocred-text","title":"Selected Pages OCRed Text","text":"<p>In case document has many pages and you are interested in OCRed text of one (or multiple) very specific pages, then select pages first and then from context menu choose \"OCRed Text\" item:</p> <p></p> <p>Note</p> <p>In case there are selected pages, OCRed Text menu item will show you OCRed   text ONLY of the selected pages.</p> <p></p>"},{"location":"user/ocr/#ocr-languages-support","title":"OCR Languages Support","text":"<p>Papermerge uses Tesseract to extract text from scanned documents. Tesseract supports over 130 languages - thus with Papermerge you can have documents in any of those languages.</p>"},{"location":"user/page-management/","title":"Page Management","text":"<p>Many times scanning documents in bulk results in documents with blank pages; some pages maybe out of order or maybe part of totally different document. Even if you notice these problems immediately it is time consuming to redo scanning process. Wouldn't it be nice to fix out of order pages without scanning all docs again?</p> <p>Page management is set of features which helps to fix scanning process errors. In other words you can delete, reorder, rotate, and extract pages within document(s).</p> <p>Every time one of the operations described in this section is applied - a new document version is created. Because of this, the changes you apply on the document like rotate, delete, extract, reorder, do not destroy the document, in other words  page management is non-destructive  process.</p> <p>Note</p> <p>In order perform any of operations described below (delete, reorder, rotate or extract) you need to have Change Permission on respective document. You have automatically granted Change Permission on the documents you uploaded (because you own the documents uploaded by you).</p>"},{"location":"user/page-management/#delete","title":"Delete","text":"<p>You can delete specific pages (for instance blank pages) from the document. Although many scanners have automatic \"remove blank pages\" feature, many times they get confused of what a blank page is. In case your scans end up with undesired blank pages you can easily remove those pages.</p> <p></p> <p>In order to delete a page, you need to select desired page by clicking on it, then <code>Right Click--&gt; Delete Page</code>.</p> <p>Every time you delete one or several pages, document version is incremented by one. For instance if document Invoice-X56.pdf currently has four pages and the document latest version is version 1, then, after deleting one page - document latest version will be 2. Thus document's version 1 has all four pages and document version 2 has three pages:</p> <p></p>"},{"location":"user/page-management/#reorder","title":"Reorder","text":"<p>Out of order pages occur very often during scanning process. Papermerge empowers users to change pages order within the document.</p> <p>For instance, in figure below you can see that pages 2 and 4 are out of place. To correct pages' order use drag 'n drop. For example grab page 2 and drop it in correct position, and then do same thing with page 3:</p> <p></p> <p>For these changes to take effect you need to click 'Apply Changes' button.</p> <p>Warning</p> <p>Document pages reorder will only be saved when you click 'Apply Changes'</p> <p></p> <p>Similarly to deleting pages, every time you save new pages order, document version will be incremented (i.e. advanced by one).</p> <p></p>"},{"location":"user/page-management/#rotate","title":"Rotate","text":"<p>Often scanned pages are upside down or maybe rotated 90\u00b0 (degrees). In order to quickly fix that, select one or multiple pages you want to rotate and then <code>Right Click --&gt; Rotate --&gt; 180\u00b0 CCW</code> (or 90\u00b0 CW, 90\u00b0 CCW depending on your specific case):</p> <p></p> <p>Note</p> <p>CW stand for clockwise. CCW stands for counter-clockwise.</p> <p>Similarly to page deletion and page ordering, every time you rotate a page, document version will be incremented (i.e. advanced by one).</p> <p>Warning</p> <p> After page rotation you have to re-run OCR  for the document. It is because if page was upside down when ingested, the OCR operation won't make sense of it and thus won't be able to extract text (and then index) from that page. After you have manually fixed the page (by correctly rotating it) - OCR will be able to extract and index page's contented.</p>"},{"location":"user/page-management/#move-document-to-document","title":"Move (Document to Document)","text":"<p>You can move one, multiple or even all strayed pages from one document (source) to another (target). If you choose to move all documents from the source - the source will be deleted, because it does not make sense to have \"document with zero pages\".</p> <p>When moving pages between documents you will be prompted to choose between two different move strategies:</p> <ol> <li>Replace target</li> <li>Append to target</li> </ol> <p>The outcome between replace vs append strategies is illustrated below:</p> <p></p> <p></p> <p>The difference is outcome of the B.pdf (target). With replace strategy, the document B.pdf ended up having two pages (which replaced previous ones), while with append strategy the document B.pdf ended up with four pages as source pages were appened to the existing ones.</p> <p>Note</p> <p>What happens if you select all source pages, i.e. when you</p> <p>select A1, B1, B2, A2? In such case - source document (A.pdf) will be    deleted, because it does not make any sense to have a document with zero    pages. For the target document (B.pdf) this case does not make any    difference, as the outcome is always the same.</p> <p>Note</p> <p>Use case when you select all pages and chose \"replace strategy\" has same outcome as merging documents.</p> <p>Now, that \"theory\" is clear, let's move on to the practical part and see Papermerge in action. First of all, note that in Papermerge you can move pages between documents either using context menu or by using drag 'n drop.</p> <p>Tip</p> <p>You can also move pages between documents with REST API as well</p>"},{"location":"user/page-management/#use-context-menu","title":"Use Context Menu","text":"<p>In order to move pages between documents, using context menu:</p> <ol> <li>Make sure both documents are open in left and right panels</li> <li>Select pages you want to move in :ref:<code>thumbnails panel &lt;Thumbnails_Panel&gt;</code> of the source document viewer</li> <li>Use right click to open context menu in source document viewer</li> <li>Choose \"Move\" context menu item</li> </ol> <p>Context menu is dynamic - which means it renders only relevant menu items. If for example you have in one panel opened :ref:<code>document viewer &lt;Viewer&gt;</code> while other panel is in :ref:<code>commander mode &lt;Commander&gt;</code>, then \"there will be \"extract\" menu item instead of \"move\". In other words, \"move\" menu item will be visible only if:</p> <ol> <li>both panels are in :ref:<code>viewer mode &lt;Viewer&gt;</code></li> <li>there is at least one page selected</li> </ol> <p></p> <p>Important<p>The arrow next to the \"Move\" menu item changes direction depending in which panel you invoke context menu - it hints direction of the pages transfer. Arrow icon of the \"Move\" item always points from source to target.</p> </p> <p></p>"},{"location":"user/page-management/#drag-n-drop","title":"Drag 'n Drop","text":"<p>In example illustrated in pictures below there are two documents:</p> <ul> <li>document A - with pages marked as A1, A2, B1, A3</li> <li>document B - with pages B2, B3</li> </ul> <p>During scan page B1 wrongly ended up in document A, although it belongs to document B.</p> <p>Note<p>A page that during the scan ended up in wrong document is called strayed page. In example above, page B1 is strayed page.</p> </p> <p>In order to fix this scanning issue, you need open documents in two panels and then drag 'n drop page B1 from document A (source) to document B (target):</p> <p></p> <p>Note<p>Pages are moved immediately after 'mouse drop' i.e. there is no need to 'click apply button' as in re-order operation</p> </p> <p>Note<p>Both documents' (source and target) version will be incremented by one</p> </p>"},{"location":"user/page-management/#extract-document-to-folder","title":"Extract (Document to Folder)","text":"<p>Page extraction is moving page out of the document as completely new document. It differs from <code>page moving &lt;page_move&gt;</code> because the destination is a folder, not a document.</p> <p>You can extract one or multiple pages at once. Pages can be extracted:</p> <ol> <li>as one document; in this case one document will be created in the target    folder, new document will contain all extracted pages</li> <li>as multiple documents; in this case multiple documents will be created in the    target folder, each new document will have one page</li> </ol> <p>Note that in Papermerge you can extract pages either using context menu or by using drag 'n drop.</p> <p>Tip</p> <p>You can also extract pages by using REST API</p>"},{"location":"user/page-management/#using-context-menu","title":"Using Context Menu","text":"<p>In order to extract pages from the document, using context menu:</p> <ol> <li>Open document in one panel and open target folder in another panel</li> <li>Select pages you want to extract in thumbnails panel of the source document viewer</li> <li>Use right click to open context menu in source document viewer</li> <li>Choose \"Extract\" context menu item</li> </ol> <p>Because of the dynamic nature of the context menu, \"Extract\" menu item will be visible only if all of the following conditions are true:</p> <ol> <li>Two panels are opened</li> <li>One of the panels is in <code>viewer mode</code> while another is in <code>commander mode</code></li> <li>There is at least one page selected</li> </ol> <p></p> <p>After you've clicked \"Extract\", the \"Extract Pages\" modal dialog will prompt you for additional details like title of the newly created document(s) and if you want to extract all pages as you or multiple documents:</p> <p></p> <p>A couple of notes here. First, newly created document will have extension \".pdf\", you cannot change that. Second, if \"Extract each page into separate document\" is checked, each pages will be, obviously enough, extracted as separate one page documents, otherwise all extracted pages will be placed into a single document in the target folder.</p> <p>Note</p> <p>Papermerge will try to make sure that newly created documents feature unique name. Thus if you choose to extract, say, two pages as separate documents, Papermerge will append to the title an UUID number. In case you choose to extract two pages into a single document - no UUID number will be appended. In case you leave \"Title format\" field empty, Papermerge will generate an unique title for you.</p>"},{"location":"user/page-management/#using-drag-n-drop","title":"Using Drag 'n Drop","text":"<p>Let's show how page extraction works by example. Say we have one document - document A - with following pages: A1, A2, B1, B2, A3. What we want to do is to extract pages B1 and B2 into a new document. As mentioned above there are two cases:</p> <ol> <li>Both pages B1 and B2 are extracted into one single new document (two page document)</li> <li>Both pages B1 and B2 are extracted into multiple (new) single page documents.</li> </ol> <p></p> <p>In order to extract pages B1 and B2 into one single new document you need to uncheck 'Extract each page into separate document' checkbox in modal dialog:</p> <p></p> <p>Similarly to other operations document A's (source document) version is incremented by one.</p>"},{"location":"user/page-management/#ocr-data","title":"OCR Data","text":"<p>Do you need re-run OCR after document's page was moved/rotated/extracted/deleted ?</p> <p>In short - no, you don't need to re-run OCR. The only exception is page rotation. Every time you rotate a page in the document, you need to re-run OCR for that document. It actually makes sense, because if page was upside down when document was ingested, the OCR operation won't make much sense of it and thus won't be able to extract any text data from the page. Once you correct that part manually (rotate page), you re-run OCR so that correct text will be extracted and then indexed.</p> <p>Note</p> <p>Generally speaking you don't need to re-run OCR after performing page management operations. The only exception from this rule is page rotation.</p> <p>For longer answer, let's clarify first what OCR data is. OCR data is: text information extracted from the document by OCR and associated with that document. That text information is stored in both database and on filesystem.</p> <p>When one page is moved from one document into another (or when page is deleted), the text associated with source (or target) document changes as well. For example, say document fruits.pdf has three pages: apples, oranges and bananas, i.e each page has only one word page 1 has work apples etc. You can find document fruits.pdf by searching 'apples' (will match first page), 'orages' (will match second page) or bananas (will match last page).</p> <p>After you extract first page (apples) from document fruits.pdf into another document, searching by term 'apples' should not reveal document 'fruits.pdf' - because term/page 'apples' is not part of it anymore.</p> <p>In order to keep text information associated with document fruits.pdf up to date, there are at least two possibilities:</p> <ol> <li>re-run OCR after each extract/delete/move/rotate operation</li> <li>re-use existing OCR and move it/delete it according to the operation</li> </ol> <p>From technical point of view 1. is very easy to implement but very inefficient in terms of computing power. Think that you have 100 pages document and you delete one blank page - what a waste of CPU resources to re-OCR entire document when OCR data is already available!</p> <p>The second possibility (point 2.) is very challenging to implement, but extremely efficient - you need to run OCR on the document only once (maybe twice, in case you decide to fix couple of pages by rotating them).</p> <p>Papermerge decided on 2. in other words, Papermerge reuses already extracted OCR data and updates it accordingly every time you re-order/move/extract/delete pages.</p> <p>The result is that whatever page management operation you perform the search results are always up-to-date without the need to re-OCR the document! As mentioned above the only exception are page rotations.</p> <p>Below is illustrated the case of three page fruits.pdf document with apples/oranges/bananas content. Initially search term 'apples' will reveal fruits.pdf document (from Inbox). After 'apples' page was extracted into separate document (found in Home/My Documents folder) search term 'apples' correctly reveals new document! Notice here that search index is updated instantaneously:</p> <p></p>"},{"location":"user/rest-api-token/","title":"REST API Token","text":"<p>In order to use REST API you will need so called REST API token.</p>"},{"location":"user/rest-api-token/#get-it","title":"Get It","text":"<ul> <li>Click User Menu (top right corner) -&gt; API Tokens</li> <li>Click \"New\" button</li> <li>Enter number of hours the token will be valid. The default value is 1 (one) hour</li> <li>Click Save button</li> </ul> <p>After you click Save button token will be displayed. Write down your token as  the token will never be displayed again .</p> <p> </p> <p>Important</p> <p>For security reasons the REST API token is displayed only one time. The values   that you see in the table are first 16 characters of the \"token digests\".   Token \"digest\" is a fancy way of identifying specific token. Don't confuse   digest value with the token value - they are different things.</p>"},{"location":"user/tags/","title":"Tags","text":"<p>Tags are sort of labels. You can associate tags to a document or to a folder. Tags have a color and a name. Once tagged, documents can be searched by their tags.</p> <p></p>"},{"location":"user/upload-documents/","title":"Upload Documents","text":"<p>There are multiple ways to upload documents to your Papermerge instance: web UI, command line utilities, REST API.</p> <p>The obvious way is via web UI. After briefly explaining how to upload documents from web user interface, this page will dive into more interesting parts: command line utilities and REST API.</p>"},{"location":"user/upload-documents/#web-ui","title":"Web UI","text":"<p>Uploading documents via user interface is the most straightforward method, just click <code>upload</code> button:</p> <p></p> <p>Documents will be uploaded into your current folder. Current folder is considered the one which you currently see as opened in web UI:</p> <p></p> <p>Also, instead of using upload button, you can drag'n drop documents from your desktop file manager into Papermerge's web ui.</p> <p></p> <p>Warning</p> <p>Currently drag 'n drop feature does not work for folders, in other words you can drag 'n drop only documents. If you want to import an folders with entire content preserved - use <code>papermerge-cli</code> described in next paragraph.</p>"},{"location":"user/upload-documents/#command-line","title":"Command Line","text":"<p>You can upload documents and folders from your local filesystem using papermerge-cli command line utility:</p> <pre><code>papermerge-cli import /path/to/local/folder/\n</code></pre> <p>Note that <code>papermerge-cli</code> will import all content of /path/to/local/folder/ directory recursively i.e. it will preserve the structure of local folder in Papermerge as well.</p> <p>You can upload one document by providing path to the document:</p> <pre><code>papermerge-cli import /path/to/document.pdf\n</code></pre> <p>Note</p> <p>By default all imported documents and folders will end up inside user's Inbox folder.</p> <p>For more information about <code>papermerge-cli</code> check papermerge-cli section.</p> <p></p>"},{"location":"user/upload-documents/#rest-api","title":"REST API","text":"<p>For uploading documents you can use directly REST API. You can access REST API swagger schema definition from user menu (upper right corner of the web UI). In order to upload a document there are two steps:</p> <ol> <li>Create document node without file</li> <li>Upload the file for the created node in previous step</li> </ol> <p>For step 1. use <code>POST /nodes/</code> REST API endpoint. For step 2 use <code>POST /documents/&lt;doc-uuid&gt;/upload</code> REST API endpoint, where <code>&lt;doc-uuid&gt;</code> is the ID of the node created in first step.</p>"},{"location":"user/user-interface/","title":"User Interface","text":"<p>Papermerge comes with a simple and intuitive user interface (UI) layout. The UI is divided into four areas:</p> <ol> <li>Navigation Menu - contains different views like tags, users, groups, inbox</li> <li>Search Bar - quick search of any document</li> <li>User Menu - contains user preferences, API tokens and other menu items.</li> <li>Commander Panel - or Commander - area for browsing documents and folders</li> </ol> <p></p>"},{"location":"user/user-interface/#dual-panel-mode","title":"Dual Panel Mode","text":"<p>Commander (in figure 1. marked with number 4.) is designed to have similar look and feel of modern desktop file browsers. This is the place where you browse your documents and folders.</p> <p>In order to assist you to quickly move around documents, folders and pages - there is a special mode - dual panel model. In dual panel mode there are two panels displayed side by side. Between two panels documents (as well as folders and pages) can be moved with one simple drag'n drop. Figure below shows how dual panel mode looks like:</p> <p></p> <p>In order to switch to dual panel mode, use Commander's upper right button:</p> <p></p> <p>To switch back to single panel mode, use close button - which is in the upper right corner of one of the panels:</p> <p></p> <p>Note<p>Close button will be displayed only on one of the panels. Although both panels look and feel exactly the same, internally application still distinguishes them as main and secondary one. Main panel is the one which is always visible and secondary panel is the on which opens and closes i.e. the one with \"close button\" in upper right corner.</p> </p>"},{"location":"user/user-interface/#commander","title":"Commander","text":"<p>Commander or Commander Panel is one of the two available panels. Commander is the panel which shows documents and folders - modern web based file browser if you will.</p> <p></p> <p></p>"},{"location":"user/user-interface/#viewer","title":"Viewer","text":"<p>Viewer or Viewer Panel or Document Viewer is one of the two available panels. Viewer is the panel in which document is opened.</p> <p></p> <p>There can be two Viewers opened side by side. This mode (i.e. dual panel mode with a Viewer in each panel) is very handy when it comes to moving pages between documents.</p> <p></p>"},{"location":"user/user-interface/#thumbnails-panel","title":"Thumbnails Panel","text":"<p>Document viewer features a thumbnails panel which can be toggles on and off. Pages can be selected only inside thumbnails panel; also pages can be dragged/dropped only from thumbnails panel.</p> <p></p>"},{"location":"user/user-management/","title":"User Management","text":"<p>Papermerge is multi user system.</p> <p>The most privileged user (which has all permissions) is called <code>superuser</code>. Brand new Papermerge instance ships with one default user - which happens to be <code>superuser</code>. With default user, you can add as many users as you wish.</p> <p>Note</p> <p>You can add multiple <code>superusers</code> as well</p>"},{"location":"user/versions/","title":"Versions","text":"<p>Papermerge is a non-destructive DMS, which means you always have available original document regardless how many transformations (page rotations, deletion, document merges) you apply on the document.</p> <p>Retention of the original is ensured because of document versioning feature. With each extra transformation you apply - a new document version is created.</p> <p> Version 1 (one)  of the uploaded document  is the original file  i.e. document without any changes applied. Original document version is always available, regardless what operation(s) you apply to the document (except deletion of the document itself).</p> <p>Any page management OCR operation on the document will increment (increase by one) its version.</p>"}]}